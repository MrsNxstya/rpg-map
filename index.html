<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <!-- –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ –±—Ä–∞—É–∑–µ—Ä—É —Å–∞–º–æ–º—É –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map of Far Lands</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –¢–µ–º–Ω–∏–π —Ñ–æ–Ω */
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            background: #121212; 
            overflow: hidden; 
            font-family: sans-serif; 
            /* –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—é —Ç–µ–∫—Å—Ç—É —Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º –∂–µ—Å—Ç–∞–º –Ω–∞ –º–æ–±—ñ–ª—å–Ω–æ–º—É */
            touch-action: none; 
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫—Ä–æ–ª—É */
        #viewport {
            width: 100%;
            height: 100%;
            overflow: auto; 
            position: relative;
            scroll-behavior: smooth; 
            -webkit-overflow-scrolling: touch; /* –ü–ª–∞–≤–Ω—ñ—Å—Ç—å –Ω–∞ iOS */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* –û–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è –∫–∞—Ä—Ç–∏ */
        #map-container {
            position: relative;
            transform-origin: 0 0;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* –°–∞–º–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
        #world-map {
            display: block;
            width: 1000px; /* –ë–∞–∑–æ–≤–∞ —à–∏—Ä–∏–Ω–∞ */
            height: auto;  /* –ó–±–µ—Ä—ñ–≥–∞—î –ø—Ä–æ–ø–æ—Ä—Ü—ñ—ó */
            pointer-events: none; /* –©–æ–± –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –±–ª–æ–∫—É–≤–∞–ª–∞ –ø–æ–¥—ñ—ó –º–∏—à—ñ/–ø–∞–ª—å—Ü—è */
        }

        /* --- –ú–∞—Ä–∫–µ—Ä–∏ --- */
        .player-marker {
            position: absolute;
            width: 40px; height: 40px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/686/686456.png');
            background-size: cover;
            transform: translate(-50%, -100%);
            z-index: 100;
            filter: drop-shadow(0 0 8px yellow);
            animation: bounce 1s infinite alternate;
        }

        .location-dot {
            position: absolute;
            width: 14px; height: 14px;
            background-color: rgba(255, 255, 255, 0.6);
            border: 2px solid #000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            cursor: pointer;
        }

        .location-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transform: translate(-50%, 10px);
            white-space: nowrap;
            border: 1px solid #ffd700;
            z-index: 99;
            pointer-events: none;
        }

        @keyframes bounce {
            from { transform: translate(-50%, -100%); }
            to { transform: translate(-50%, -120%); }
        }

        /* –ö–Ω–æ–ø–∫–∏ –∑—É–º—É */
        .controls {
            position: fixed; bottom: 30px; right: 20px;
            display: flex; flex-direction: column; gap: 15px; z-index: 1000;
        }
        .btn {
            width: 50px; height: 50px;
            background: rgba(30, 30, 30, 0.9); color: white;
            border: 1px solid #777; border-radius: 50%;
            font-size: 24px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; user-select: none;
        }
        .btn:active { transform: scale(0.9); background: #555; }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä–∏—Ç–∏ */
        .close-btn {
            position: fixed; top: 15px; left: 15px;
            background: rgba(200, 50, 50, 0.9); color: white;
            padding: 8px 16px; border-radius: 20px;
            font-weight: bold; cursor: pointer; z-index: 1000;
        }
    </style>
</head>
<body>

    <div class="close-btn" onclick="Telegram.WebApp.close()">–ó–∞–∫—Ä–∏—Ç–∏</div>

    <div id="viewport">
        <div id="map-container">
            <!-- –¢–≤–æ—è –∫–∞—Ä—Ç–∞ -->
            <img id="world-map" src="https://i.im.ge/2025/11/26/4hXkPS.Far-Lands.png" alt="World Map">
            <div id="markers-layer"></div>
        </div>
    </div>

    <div class="controls">
        <div class="btn" onclick="changeZoom(1.2)">‚ûï</div>
        <div class="btn" onclick="changeZoom(0.8)">‚ûñ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –¢–í–û–á –ö–û–û–†–î–ò–ù–ê–¢–ò ---
        const MAP_LOCATIONS = {
            1: { top: 78.03, left: 50.77, name: "Hilinguard" },
            2: { top: 11.81, left: 69.77, name: "Windfoldigan" },
            3: { top: 67.14, left: 16.68, name: "Forestfall" }, 
            4: { top: 32.00, left: 32.18, name: "Stormfallen" },
            5: { top: 58.98, left: 49.52, name: "Oceanrise" }, 
            6: { top: 32.00, left: 60.03, name: "Heathergan" }, 
            7: { top: 55.35, left: 56.83, name: "Winterfall" },
            8: { top: 70.77, left: 79.28, name: "Liddingal" },
            
        };

        const viewport = document.getElementById('viewport');
        const mapContainer = document.getElementById('map-container');
        const mapImg = document.getElementById('world-map');
        const markersLayer = document.getElementById('markers-layer');

        let currentZoom = 1.0;
        const BASE_WIDTH = 1000; 

        // –û—Ç—Ä–∏–º—É—î–º–æ ID –∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const locId = urlParams.get('loc');
        const targetLoc = MAP_LOCATIONS[locId];

        // --- –§–£–ù–ö–¶–Ü–á –ú–ê–°–®–¢–ê–ë–£–í–ê–ù–ù–Ø ---

        function setZoom(zoomLevel) {
            // –û–±–º–µ–∂–µ–Ω–Ω—è –∑—É–º—É
            if (zoomLevel < 0.3) zoomLevel = 0.3; 
            if (zoomLevel > 4.0) zoomLevel = 4.0; // –¢—Ä–æ—Ö–∏ –∑–±—ñ–ª—å—à–∏–≤ –º–∞–∫—Å –∑—É–º –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
            
            currentZoom = zoomLevel;
            const newWidth = BASE_WIDTH * currentZoom;
            
            mapImg.style.width = newWidth + 'px';
            mapContainer.style.width = newWidth + 'px';
            
            if (mapImg.naturalWidth) {
                 const ratio = mapImg.naturalHeight / mapImg.naturalWidth;
                 mapContainer.style.height = (newWidth * ratio) + 'px';
            }

            // –ù–µ —Ü–µ–Ω—Ç—Ä—É—î–º–æ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –º—ñ–Ω—ñ-–∑—É–º—ñ –ø–∞–ª—å—Ü—è–º–∏, —â–æ–± –Ω–µ —Å–º–∏–∫–∞–ª–æ—Å—å
        }

        // –§—É–Ω–∫—Ü—ñ—è —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è
        function centerOnLocation(loc, mapWidth) {
            const ratio = mapImg.naturalHeight / mapImg.naturalWidth || 0.7;
            const x = (loc.left / 100) * mapWidth;
            const y = (loc.top / 100) * (mapWidth * ratio);
            
            const screenW = viewport.clientWidth;
            const screenH = viewport.clientHeight;
            
            viewport.scrollLeft = x - screenW / 2;
            viewport.scrollTop = y - screenH / 2;
        }

        function changeZoom(factor) {
            setZoom(currentZoom * factor);
            // –ü—Ä–∏ –∫–Ω–æ–ø–∫–æ–≤–æ–º—É –∑—É–º—ñ –º–æ–∂–Ω–∞ —Ü–µ–Ω—Ç—Ä—É–≤–∞—Ç–∏ –Ω–∞ –≥—Ä–∞–≤—Ü–µ–≤—ñ (—è–∫—â–æ –≤—ñ–Ω —î)
            if (targetLoc) {
                 const w = BASE_WIDTH * currentZoom;
                 centerOnLocation(targetLoc, w);
            }
        }

        // --- –ú–ê–†–ö–ï–†–ò (–¢–≤–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó) ---

        function createPlayerMarker(loc, text) {
            const marker = document.createElement('div');
            marker.className = 'player-marker';
            marker.style.left = loc.left + '%';
            marker.style.top = loc.top + '%';
            
            const label = document.createElement('div');
            label.className = 'location-label';
            label.innerText = text;
            label.style.left = loc.left + '%';
            label.style.top = loc.top + '%';
            
            markersLayer.appendChild(marker);
            markersLayer.appendChild(label);
        }

        function createDot(loc) {
            const dot = document.createElement('div');
            dot.className = 'location-dot';
            dot.style.left = loc.left + '%';
            dot.style.top = loc.top + '%';
            dot.onclick = () => alert(loc.name);
            markersLayer.appendChild(dot);
        }

        // --- –ó–ê–ü–£–°–ö ---
        mapImg.onload = () => {
            for (const [id, loc] of Object.entries(MAP_LOCATIONS)) {
                if (id != locId) createDot(loc);
            }

            if (targetLoc) {
                createPlayerMarker(targetLoc, "üìç –í–ò –¢–£–¢");
                setZoom(1.5); 
                // –¶–µ–Ω—Ç—Ä—É—î–º–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
                setTimeout(() => centerOnLocation(targetLoc, BASE_WIDTH * 1.5), 100);
            } else {
                const screenWidth = window.innerWidth;
                const fitZoom = screenWidth / BASE_WIDTH;
                setZoom(fitZoom > 1 ? 1 : fitZoom); 
            }
        };

        // ==================================================
        // üî• –ù–û–í–ê –õ–û–ì–Ü–ö–ê –î–õ–Ø –¢–ï–õ–ï–§–û–ù–£ (PINCH-TO-ZOOM)
        // ==================================================

        let initialDistance = 0;
        let initialZoom = 1.0;

        // –ö–æ–ª–∏ —Ç–æ—Ä–∫–∞—î–º–æ—Å—è –µ–∫—Ä–∞–Ω—É
        viewport.addEventListener('touchstart', (e) => {
            // –Ø–∫—â–æ –¥–≤–∞ –ø–∞–ª—å—Ü—ñ - —Ü–µ –∑—É–º
            if (e.touches.length === 2) {
                e.preventDefault(); // –ë–ª–æ–∫—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É
                initialDistance = getDistance(e.touches);
                initialZoom = currentZoom;
            }
        }, { passive: false });

        // –ö–æ–ª–∏ —Ä—É—Ö–∞—î–º–æ –ø–∞–ª—å—Ü—è–º–∏
        viewport.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault(); // –ë–ª–æ–∫—É—î–º–æ, —â–æ–± —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –Ω–µ —Å–∫–∞–∫–∞–ª–∞
                
                const currentDistance = getDistance(e.touches);
                if (initialDistance > 0) {
                    // –†–∞—Ö—É—î–º–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –∑–º—ñ–Ω–∏
                    const scale = currentDistance / initialDistance;
                    
                    // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –Ω–æ–≤–∏–π –∑—É–º
                    // –ú–Ω–æ–∂–∏–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∑—É–º —Ü—å–æ–≥–æ –∂–µ—Å—Ç—É –Ω–∞ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç
                    setZoom(initialZoom * scale);
                }
            }
        }, { passive: false });

        // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤—ñ–¥—Å—Ç–∞–Ω—ñ –º—ñ–∂ –ø–∞–ª—å—Ü—è–º–∏
        function getDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

    </script>
</body>
</html>
