<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map of Far Lands</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û—Å–Ω–æ–≤–Ω–∏–π —Å—Ç–∏–ª—å —Å—Ç–æ—Ä—ñ–Ω–∫–∏ - —á–æ—Ä–Ω–∏–π —Ñ–æ–Ω, –±–µ–∑ –≤—ñ–¥—Å—Ç—É–ø—ñ–≤ */
        body, html { margin: 0; padding: 0; height: 100%; background: #121212; overflow: hidden; font-family: sans-serif; }
        
        /* –í—ñ–∫–Ω–æ –ø–µ—Ä–µ–≥–ª—è–¥—É (Viewport) - —Ç—É—Ç –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Å–∫—Ä–æ–ª */
        #viewport {
            width: 100%;
            height: 100%;
            overflow: auto; /* –î–æ–∑–≤–æ–ª—è—î —Ä—É—Ö–∞—Ç–∏ –∫–∞—Ä—Ç—É –ø–∞–ª—å—Ü–µ–º */
            position: relative;
            scroll-behavior: smooth; 
            -webkit-overflow-scrolling: touch; /* –ü–ª–∞–≤–Ω—ñ—Å—Ç—å –Ω–∞ iOS */
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ —ñ –º–∞—Ä–∫–µ—Ä—ñ–≤ */
        #map-container {
            position: relative;
            transform-origin: 0 0;
        }

        /* –°–∞–º–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–∞—Ä—Ç–∏ */
        #world-map {
            display: block;
            width: 1000px; /* –ë–∞–∑–æ–≤–∞ —à–∏—Ä–∏–Ω–∞, –±—É–¥–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º */
            height: auto;
        }

        /* --- –°–¢–ò–õ–Ü –ú–ê–†–ö–ï–†–Ü–í --- */
        
        /* –ú–∞—Ä–∫–µ—Ä –≥—Ä–∞–≤—Ü—è (–ë–ª–∏–º–∞—î) */
        .player-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            /* –Ü–∫–æ–Ω–∫–∞ –≥–µ—Ä–æ—è */
            background-image: url('https://cdn-icons-png.flaticon.com/512/686/686456.png');
            background-size: cover;
            transform: translate(-50%, -100%); /* –¶–µ–Ω—Ç—Ä—É—î–º–æ –≤—ñ—Å—Ç—Ä—è */
            z-index: 100;
            filter: drop-shadow(0 0 8px yellow); /* –°–≤—ñ—Ç—ñ–Ω–Ω—è */
            animation: bounce 1s infinite alternate;
        }

        /* –ú–∞—Ä–∫–µ—Ä–∏ —ñ–Ω—à–∏—Ö –ª–æ–∫–∞—Ü—ñ–π (—Å—Ç–∞—Ç–∏—á–Ω—ñ —Ç–æ—á–∫–∏) */
        .location-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: rgba(255, 255, 255, 0.5);
            border: 2px solid #000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            cursor: pointer;
        }

        /* –ü—ñ–¥–ø–∏—Å –ª–æ–∫–∞—Ü—ñ—ó */
        .location-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transform: translate(-50%, 5px); /* –¢—Ä–æ—Ö–∏ –Ω–∏–∂—á–µ —Ç–æ—á–∫–∏ */
            white-space: nowrap;
            border: 1px solid #ffd700;
            z-index: 99;
            pointer-events: none; /* –©–æ–± –Ω–µ –∑–∞–≤–∞–∂–∞–≤ –∫–ª—ñ–∫–∞—Ç–∏ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è —Å—Ç—Ä–∏–±–∞–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ */
        @keyframes bounce {
            from { transform: translate(-50%, -100%); }
            to { transform: translate(-50%, -120%); }
        }

        /* --- –ö–ù–û–ü–ö–ò –ö–ï–†–£–í–ê–ù–ù–Ø --- */
        
        .controls {
            position: fixed;
            bottom: 30px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .btn {
            width: 50px;
            height: 50px;
            background: rgba(30, 30, 30, 0.9);
            color: white;
            border: 1px solid #777;
            border-radius: 50%;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            user-select: none;
            transition: transform 0.1s;
        }
        
        .btn:active { transform: scale(0.9); background: #555; }

        .close-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            background: rgba(200, 50, 50, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä–∏—Ç—Ç—è (—â–æ–± –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –≤ —á–∞—Ç) -->
    <div class="close-btn" onclick="Telegram.WebApp.close()">–ó–∞–∫—Ä–∏—Ç–∏</div>

    <!-- –í—ñ–∫–Ω–æ –∑ –∫–∞—Ä—Ç–æ—é -->
    <div id="viewport">
        <div id="map-container">
            <!-- üî• –í–ê–ñ–õ–ò–í–û: –§–∞–π–ª –∫–∞—Ä—Ç–∏–Ω–∫–∏ –º–∞—î –Ω–∞–∑–∏–≤–∞—Ç–∏—Å—è map.jpg —ñ –ª–µ–∂–∞—Ç–∏ –ø–æ—Ä—É—á -->
            <!-- –ê–±–æ –≤—Å—Ç–∞–≤ —Å—é–¥–∏ –ø—Ä—è–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ -->
            <img id="world-map" src="map.jpg" alt="World Map">
            
            <!-- –°—é–¥–∏ —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –º–∞—Ä–∫–µ—Ä–∏ -->
            <div id="markers-layer"></div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –∑—É–º—É -->
    <div class="controls">
        <div class="btn" onclick="changeZoom(1.2)">‚ûï</div>
        <div class="btn" onclick="changeZoom(0.8)">‚ûñ</div>
    </div>

    <script>
        // 1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è WebApp
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–æ–∑–≥–æ—Ä—Ç–∞—î–º–æ –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω
        tg.enableClosingConfirmation(); // –ó–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ

        // 2. –ë–ê–ó–ê –ö–û–û–†–î–ò–ù–ê–¢ (–¢–≤–æ—ó –¥–∞–Ω—ñ)
        // left = X (%), top = Y (%)
        const MAP_LOCATIONS = {
            1: { top: 78.03, left: 50.77, name: "Hilinguard" },
            2: { top: 11.81, left: 69.77, name: "Windfoldigan" },
            3: { top: 58.98, left: 49.52, name: "Forestfall" }, 
            4: { top: 32.00, left: 32.18, name: "Stormfallen" },
            5: { top: 32.00, left: 60.03, name: "Oceanrise" }, 
            6: { top: 55.35, left: 56.83, name: "Heathergan" }, 
            7: { top: 67.14, left: 16.68, name: "Winterfall" },
            8: { top: 70.77, left: 79.28, name: "Liddingal" },
        };

        // –û—Ç—Ä–∏–º—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏
        const viewport = document.getElementById('viewport');
        const mapContainer = document.getElementById('map-container');
        const mapImg = document.getElementById('world-map');
        const markersLayer = document.getElementById('markers-layer');

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑—É–º—É
        let currentZoom = 1.0; 
        const BASE_WIDTH = 1000; // –ë–∞–∑–æ–≤–∞ —à–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤

        // 3. –û—Ç—Ä–∏–º—É—î–º–æ ID –ª–æ–∫–∞—Ü—ñ—ó, —è–∫—É –ø–µ—Ä–µ–¥–∞–≤ Python (—á–µ—Ä–µ–∑ URL ?loc=5)
        const urlParams = new URLSearchParams(window.location.search);
        const locId = urlParams.get('loc');
        const targetLoc = MAP_LOCATIONS[locId];

        // –§—É–Ω–∫—Ü—ñ—è –∑–º—ñ–Ω–∏ –∑—É–º—É
        function setZoom(zoomLevel) {
            // –õ—ñ–º—ñ—Ç–∏: –Ω–µ –º–µ–Ω—à–µ 50%, –Ω–µ –±—ñ–ª—å—à–µ 300%
            if (zoomLevel < 0.5) zoomLevel = 0.5;
            if (zoomLevel > 3.0) zoomLevel = 3.0;
            
            currentZoom = zoomLevel;
            const newWidth = BASE_WIDTH * currentZoom;
            
            // –ó–º—ñ–Ω—é—î–º–æ —Ä–æ–∑–º—ñ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            mapImg.style.width = newWidth + 'px';
            mapContainer.style.width = newWidth + 'px';
            // –í–∏—Å–æ—Ç–∞ –∞–≤—Ç–æ, –∞–ª–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ç–æ—á–Ω–∞ –≤–∏—Å–æ—Ç–∞
            mapContainer.style.height = (newWidth * (mapImg.naturalHeight / mapImg.naturalWidth || 0.7)) + 'px';
            
            // –Ø–∫—â–æ —î –≥—Ä–∞–≤–µ—Ü—å, —Ü–µ–Ω—Ç—Ä—É—î–º–æ –Ω–∞ –Ω—å–æ–º—É –ø—Ä–∏ –∑—É–º—ñ (—â–æ–± –Ω–µ –≥—É–±–∏–≤—Å—è)
            if (targetLoc) {
                centerOnLocation(targetLoc, newWidth);
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –µ–∫—Ä–∞–Ω—É –Ω–∞ —Ç–æ—á—Ü—ñ
        function centerOnLocation(loc, mapWidth) {
            const ratio = mapImg.naturalHeight / mapImg.naturalWidth || 0.7; 
            const mapHeight = mapWidth * ratio;

            // –î–µ —Ü—è —Ç–æ—á–∫–∞ –∑–∞—Ä–∞–∑ —É –ø—ñ–∫—Å–µ–ª—è—Ö?
            const x = (loc.left / 100) * mapWidth;
            const y = (loc.top / 100) * mapHeight;

            // –†–æ–∑–º—ñ—Ä–∏ –µ–∫—Ä–∞–Ω—É —Ç–µ–ª–µ—Ñ–æ–Ω—É
            const screenW = viewport.clientWidth;
            const screenH = viewport.clientHeight;

            // –°–∫—Ä–æ–ª–∏–º–æ —Ç–∞–∫, —â–æ–± —Ç–æ—á–∫–∞ –±—É–ª–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
            viewport.scrollLeft = x - screenW / 2;
            viewport.scrollTop = y - screenH / 2;
        }

        function changeZoom(factor) {
            setZoom(currentZoom * factor);
        }

        // 4. –ì–û–õ–û–í–ù–ò–ô –ó–ê–ü–£–°–ö (–ö–æ–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∞—Å—å)
        mapImg.onload = () => {
            // –ú–∞–ª—é—î–º–æ –≤—Å—ñ —Ç–æ—á–∫–∏ –º—ñ—Å—Ç (–¥–ª—è –∫—Ä–∞—Å–∏)
            for (const [id, loc] of Object.entries(MAP_LOCATIONS)) {
                // –ù–µ –º–∞–ª—é—î–º–æ —Ç–æ—á–∫—É —Ç–∞–º, –¥–µ —Å—Ç–æ—ó—Ç—å –≥—Ä–∞–≤–µ—Ü—å (—Ç–∞–º –±—É–¥–µ –≤–µ–ª–∏–∫–∏–π –º–∞—Ä–∫–µ—Ä)
                if (id != locId) {
                    createDot(loc);
                }
            }

            if (targetLoc) {
                // –Ø–∫—â–æ –º–∏ –∑–Ω–∞—î–º–æ, –¥–µ –≥—Ä–∞–≤–µ—Ü—å -> –°—Ç–∞–≤–∏–º–æ –í–µ–ª–∏–∫–∏–π –ú–∞—Ä–∫–µ—Ä
                createPlayerMarker(targetLoc, "üìç –í–ò –¢–£–¢");
                // –°—Ç–∞—Ä—Ç: –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–π –∑—É–º (1.8 = 180%)
                setZoom(1.8); 
            } else {
                // –Ø–∫—â–æ –ª–æ–∫–∞—Ü—ñ—è –Ω–µ–≤—ñ–¥–æ–º–∞ -> –ü–æ–∫–∞–∑—É—î–º–æ –≤—Å—é –∫–∞—Ä—Ç—É (80%)
                setZoom(0.8);
            }
        };

        // –§—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ –≥—Ä–∞–≤—Ü—è
        function createPlayerMarker(loc, text) {
            const marker = document.createElement('div');
            marker.className = 'player-marker';
            marker.style.left = loc.left + '%';
            marker.style.top = loc.top + '%';
            
            const label = document.createElement('div');
            label.className = 'location-label';
            label.innerText = text;
            label.style.left = loc.left + '%';
            label.style.top = loc.top + '%';
            
            markersLayer.appendChild(marker);
            markersLayer.appendChild(label);
        }

        // –§—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ç–æ—á–æ–∫ –º—ñ—Å—Ç
        function createDot(loc) {
            const dot = document.createElement('div');
            dot.className = 'location-dot';
            dot.style.left = loc.left + '%';
            dot.style.top = loc.top + '%';
            // –ü–æ–∫–∞–∑—É—î–º–æ –Ω–∞–∑–≤—É –ø—Ä–∏ –∫–ª—ñ–∫—É
            dot.onclick = () => alert(loc.name); 
            markersLayer.appendChild(dot);
        }

    </script>
</body>
</html>
