<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map of Far Lands</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –¢–µ–º–Ω–∏–π —Ñ–æ–Ω, —â–æ–± –º–µ–∂—ñ –≤–∏–≥–ª—è–¥–∞–ª–∏ —Å—Ç–∏–ª—å–Ω–æ */
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            background: #000000; 
            overflow: hidden; 
            font-family: sans-serif; 
        }
        
        /* –í—ñ–∫–Ω–æ –ø–µ—Ä–µ–≥–ª—è–¥—É */
        #viewport {
            width: 100%;
            height: 100%;
            overflow: auto; 
            position: relative;
            /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∏, —è–∫—â–æ –≤–æ–Ω–∞ –º–µ–Ω—à–∞ –∑–∞ –µ–∫—Ä–∞–Ω */
            display: flex;
            justify-content: center;
            align-items: center;
            /* –ü–ª–∞–≤–Ω–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
            scroll-behavior: smooth; 
            -webkit-overflow-scrolling: touch;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç–∏ */
        #map-container {
            position: relative;
            transform-origin: 0 0;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); /* –¢—ñ–Ω—å –¥–ª—è –∫—Ä–∞—Å–∏ */
        }

        /* –°–∞–º–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ - –ì–û–õ–û–í–ù–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –ó–ö–û–®–ï–ù–ù–Ø */
        #world-map {
            display: block;
            width: 100%;      /* –ó–∞–π–º–∞—î –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
            height: auto;     /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–∏—Å–æ—Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –ø—Ä–æ–ø–æ—Ä—Ü—ñ—ó! */
            object-fit: contain;
        }

        /* --- –ú–∞—Ä–∫–µ—Ä–∏ --- */
        .player-marker {
            position: absolute;
            width: 40px; height: 40px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/686/686456.png');
            background-size: cover;
            transform: translate(-50%, -100%);
            z-index: 100;
            filter: drop-shadow(0 0 8px yellow);
            animation: bounce 1s infinite alternate;
        }

        .location-dot {
            position: absolute;
            width: 14px; height: 14px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid #000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .location-dot:active { transform: translate(-50%, -50%) scale(1.5); }

        .location-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transform: translate(-50%, 10px);
            white-space: nowrap;
            border: 1px solid #ffd700;
            z-index: 99;
            pointer-events: none;
        }

        @keyframes bounce {
            from { transform: translate(-50%, -100%); }
            to { transform: translate(-50%, -120%); }
        }

        /* –ö–Ω–æ–ø–∫–∏ –∑—É–º—É */
        .controls {
            position: fixed; bottom: 30px; right: 20px;
            display: flex; flex-direction: column; gap: 15px; z-index: 1000;
        }
        .btn {
            width: 50px; height: 50px;
            background: rgba(30, 30, 30, 0.9); color: white;
            border: 1px solid #777; border-radius: 50%;
            font-size: 24px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; user-select: none;
        }
        .btn:active { transform: scale(0.9); background: #555; }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä–∏—Ç–∏ */
        .close-btn {
            position: fixed; top: 15px; left: 15px;
            background: rgba(200, 50, 50, 0.9); color: white;
            padding: 8px 16px; border-radius: 20px;
            font-weight: bold; cursor: pointer; z-index: 1000;
        }
    </style>
</head>
<body>

    <div class="close-btn" onclick="Telegram.WebApp.close()">–ó–∞–∫—Ä–∏—Ç–∏</div>

    <div id="viewport">
        <div id="map-container">
            <!-- –¢–≤–æ—è –∫–∞—Ä—Ç–∞ –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É -->
            <img id="world-map" src="https://i.im.ge/2025/11/26/4hXkPS.Far-Lands.png" alt="World Map">
            <!-- –®–∞—Ä –º–∞—Ä–∫–µ—Ä—ñ–≤ -->
            <div id="markers-layer"></div>
        </div>
    </div>

    <div class="controls">
        <div class="btn" onclick="changeZoom(1.2)">‚ûï</div>
        <div class="btn" onclick="changeZoom(0.8)">‚ûñ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ö–û–û–†–î–ò–ù–ê–¢–ò –õ–û–ö–ê–¶–Ü–ô ---
        const MAP_LOCATIONS = {
            1: { top: 78.03, left: 50.77, name: "Hilinguard" },
            2: { top: 11.81, left: 69.77, name: "Windfoldigan" },
            3: { top: 67.14, left: 16.68, name: "Forestfall" }, 
            4: { top: 32.00, left: 32.18, name: "Stormfallen" },
            5: { top: 58.98, left: 49.52, name: "Oceanrise" }, 
            6: { top: 32.00, left: 60.03, name: "Heathergan" }, 
            7: { top: 55.35, left: 56.83, name: "Winterfall" },
            8: { top: 70.77, left: 79.28, name: "Liddingal" },
            
        };

        const viewport = document.getElementById('viewport');
        const mapContainer = document.getElementById('map-container');
        const mapImg = document.getElementById('world-map');
        const markersLayer = document.getElementById('markers-layer');

        // –ë–∞–∑–æ–≤–∞ —à–∏—Ä–∏–Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤ –º–∞—Å—à—Ç–∞–±—É
        const BASE_IMAGE_WIDTH = 1000; 
        let currentWidth = BASE_IMAGE_WIDTH;

        // –û—Ç—Ä–∏–º—É—î–º–æ ID –∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const locId = urlParams.get('loc');
        const targetLoc = MAP_LOCATIONS[locId];

        // --- –§–£–ù–ö–¶–Ü–á –ú–ê–°–®–¢–ê–ë–£–í–ê–ù–ù–Ø ---

        function setMapWidth(newWidth) {
            // –û–±–º–µ–∂–µ–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É (—â–æ–± –Ω–µ –∑–Ω–∏–∫–∞–ª–∞)
            const minWidth = window.innerWidth * 0.5; 
            if (newWidth < minWidth) newWidth = minWidth;
            
            // –û–±–º–µ–∂–µ–Ω–Ω—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É (—â–æ–± –Ω–µ –ø—ñ–∫—Å–µ–ª—ñ–∑—É–≤–∞–ª–∞—Å—å —Å–∏–ª—å–Ω–æ)
            const maxWidth = BASE_IMAGE_WIDTH * 4;
            if (newWidth > maxWidth) newWidth = maxWidth;

            currentWidth = newWidth;
            
            // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —à–∏—Ä–∏–Ω—É
            mapImg.style.width = currentWidth + 'px';
            mapContainer.style.width = currentWidth + 'px';
            
            // –í–∏—Å–æ—Ç–∞ –ø—ñ–¥–ª–∞—à—Ç—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, –∞–ª–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É —Ç—Ä–µ–±–∞ –∑–Ω–∞—Ç–∏ –≤–∏—Å–æ—Ç—É –¥–ª—è —Å–∫—Ä–æ–ª—É
            // –†–∞—Ö—É—î–º–æ –ø—Ä–æ–ø–æ—Ä—Ü—ñ—é
            if (mapImg.naturalWidth) {
                const ratio = mapImg.naturalHeight / mapImg.naturalWidth;
                mapContainer.style.height = (currentWidth * ratio) + 'px';
            }
        }

        function zoomIn() {
            setMapWidth(currentWidth * 1.2);
            // –Ø–∫—â–æ —î —Ü—ñ–ª—å, —Ü–µ–Ω—Ç—Ä—É—î–º–æ –Ω–∞ –Ω—ñ–π
            if (targetLoc) centerOnLocation(targetLoc);
        }

        function zoomOut() {
            setMapWidth(currentWidth * 0.8);
            // –Ø–∫—â–æ –≤—ñ–¥–¥–∞–ª—è—î–º–æ, –ø—Ä–æ—Å—Ç–æ —Ü–µ–Ω—Ç—Ä—É—î–º–æ –ø–µ—Ä–µ–≥–ª—è–¥
        }

        // –ü—Ä–∏–≤'—è–∑–∫–∞ –∫–Ω–æ–ø–æ–∫
        // (–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ window.zoomIn —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤)
        window.changeZoom = function(factor) {
            if (factor > 1) zoomIn(); else zoomOut();
        }

        // --- –¶–ï–ù–¢–†–£–í–ê–ù–ù–Ø ---

        function centerOnLocation(loc) {
            if (!mapImg.naturalWidth) return;
            
            const ratio = mapImg.naturalHeight / mapImg.naturalWidth;
            
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–æ—á–∫–∏ –≤ –ø—ñ–∫—Å–µ–ª—è—Ö –Ω–∞ –ø–æ—Ç–æ—á–Ω—ñ–π –∫–∞—Ä—Ç—ñ
            const x = (loc.left / 100) * currentWidth;
            const y = (loc.top / 100) * (currentWidth * ratio);
            
            // –†–æ–∑–º—ñ—Ä–∏ –µ–∫—Ä–∞–Ω—É
            const screenW = viewport.clientWidth;
            const screenH = viewport.clientHeight;
            
            // –°–∫—Ä–æ–ª–∏–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            viewport.scrollLeft = x - screenW / 2;
            viewport.scrollTop = y - screenH / 2;
        }

        // --- –ú–ê–†–ö–ï–†–ò ---

        function createPlayerMarker(loc, text) {
            const marker = document.createElement('div');
            marker.className = 'player-marker';
            marker.style.left = loc.left + '%';
            marker.style.top = loc.top + '%';
            
            const label = document.createElement('div');
            label.className = 'location-label';
            label.innerText = text;
            label.style.left = loc.left + '%';
            label.style.top = loc.top + '%';
            
            markersLayer.appendChild(marker);
            markersLayer.appendChild(label);
        }

        function createDot(loc) {
            const dot = document.createElement('div');
            dot.className = 'location-dot';
            dot.style.left = loc.left + '%';
            dot.style.top = loc.top + '%';
            dot.onclick = () => alert(loc.name);
            markersLayer.appendChild(dot);
        }

        // --- –ó–ê–ü–£–°–ö ---
        mapImg.onload = () => {
            // 1. –ú–∞–ª—é—î–º–æ —Ç–æ—á–∫–∏
            for (const [id, loc] of Object.entries(MAP_LOCATIONS)) {
                if (id != locId) createDot(loc);
            }

            // 2. –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –∑—É–º —ñ –ø–æ–∑–∏—Ü—ñ—é
            if (targetLoc) {
                // –ì–†–ê–í–ï–¶–¨ –Ñ: –°—Ç–∞–≤–∏–º–æ –º–∞—Ä–∫–µ—Ä —ñ –∑—É–º–∏–º–æ –±–ª–∏–∂—á–µ
                createPlayerMarker(targetLoc, "üìç –í–ò –¢–£–¢");
                
                // –†–æ–±–∏–º–æ –∫–∞—Ä—Ç—É —Ç—Ä—ñ—à–∫–∏ –±—ñ–ª—å—à–æ—é –∑–∞ –µ–∫—Ä–∞–Ω, —â–æ–± –±—É–ª–æ –≤–∏–¥–Ω–æ –¥–µ—Ç–∞–ª—ñ
                setMapWidth(window.innerWidth * 2.0); 
                centerOnLocation(targetLoc);
            } else {
                // –ì–†–ê–í–¶–Ø –ù–ï–ú–ê (–ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≥–ª—è–¥): –ü—ñ–¥–≥–∞–Ω—è—î–º–æ –∫–∞—Ä—Ç—É –ø—ñ–¥ —à–∏—Ä–∏–Ω—É –µ–∫—Ä–∞–Ω—É
                setMapWidth(window.innerWidth);
                // –¶–µ–Ω—Ç—Ä—É—î–º–æ –∫–∞—Ä—Ç—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (CSS flexbox —Ü–µ –∑—Ä–æ–±–∏—Ç—å —Å–∞–º)
            }
        };
    </script>
</body>
</html>
