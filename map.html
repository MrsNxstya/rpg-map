<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <!-- –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ –±—Ä–∞—É–∑–µ—Ä—É —Å–∞–º–æ–º—É –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map of Far Lands</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –¢–µ–º–Ω–∏–π —Ñ–æ–Ω */
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            background: #121212; 
            overflow: hidden; 
            font-family: sans-serif; 
            touch-action: none; /* –í–∞–∂–ª–∏–≤–æ –¥–ª—è –∂–µ—Å—Ç—ñ–≤ */
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* –í—ñ–∫–Ω–æ –ø–µ—Ä–µ–≥–ª—è–¥—É */
        #viewport {
            width: 100%;
            height: 100%;
            overflow: auto; /* –î–æ–∑–≤–æ–ª—è—î —Å–∫—Ä–æ–ª */
            position: relative;
            cursor: grab; /* –ö—É—Ä—Å–æ—Ä —Ä—É–∫–∞ –¥–ª—è –ü–ö */
            display: block; 
        }

        #viewport:active {
            cursor: grabbing; /* –ö—É—Ä—Å–æ—Ä "—Å—Ö–æ–ø–∏–≤" */
        }

        /* –û–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è –∫–∞—Ä—Ç–∏ */
        #map-container {
            position: relative;
            transform-origin: 0 0;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ –∫–∞—Ä—Ç—É –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ */
            margin: 0 auto;
        }

        /* –°–∞–º–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
        #world-map {
            display: block;
            width: 1000px; 
            height: auto; 
            pointer-events: none; /* –©–æ–± –Ω–µ –∑–∞–≤–∞–∂–∞–ª–æ —Ç—è–≥–∞—Ç–∏ –º–∏—à–∫–æ—é */
        }

        /* --- –ú–∞—Ä–∫–µ—Ä–∏ --- */
        .player-marker {
            position: absolute;
            width: 40px; height: 40px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/686/686456.png');
            background-size: cover;
            transform: translate(-50%, -100%);
            z-index: 100;
            filter: drop-shadow(0 0 8px yellow);
            animation: bounce 1s infinite alternate;
        }

        .location-dot {
            position: absolute;
            width: 14px; height: 14px;
            background-color: rgba(255, 255, 255, 0.6);
            border: 2px solid #000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            cursor: pointer;
        }

        .location-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transform: translate(-50%, 10px);
            white-space: nowrap;
            border: 1px solid #ffd700;
            z-index: 99;
            pointer-events: none;
        }

        @keyframes bounce {
            from { transform: translate(-50%, -100%); }
            to { transform: translate(-50%, -120%); }
        }

        /* –ö–Ω–æ–ø–∫–∏ –∑—É–º—É */
        .controls {
            position: fixed; bottom: 30px; right: 20px;
            display: flex; flex-direction: column; gap: 15px; z-index: 1000;
        }
        .btn {
            width: 50px; height: 50px;
            background: rgba(30, 30, 30, 0.9); color: white;
            border: 1px solid #777; border-radius: 50%;
            font-size: 24px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; user-select: none;
        }
        .btn:active { transform: scale(0.9); background: #555; }

        .close-btn {
            position: fixed; top: 15px; left: 15px;
            background: rgba(200, 50, 50, 0.9); color: white;
            padding: 8px 16px; border-radius: 20px;
            font-weight: bold; cursor: pointer; z-index: 1000;
        }
    </style>
</head>
<body>

    <div class="close-btn" onclick="Telegram.WebApp.close()">–ó–∞–∫—Ä–∏—Ç–∏</div>

    <div id="viewport">
        <div id="map-container">
            <!-- –ö–∞—Ä—Ç–∞ -->
            <img id="world-map" src="https://i.im.ge/2025/11/26/4hXkPS.Far-Lands.png" alt="World Map">
            <div id="markers-layer"></div>
        </div>
    </div>

    <div class="controls">
        <div class="btn" onclick="changeZoom(1.2)">‚ûï</div>
        <div class="btn" onclick="changeZoom(0.8)">‚ûñ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –¢–í–û–á –ö–û–û–†–î–ò–ù–ê–¢–ò ---
        const MAP_LOCATIONS = {
            1: { top: 78.03, left: 50.77, name: "Hilinguard" },
            2: { top: 11.81, left: 69.77, name: "Windfoldigan" },
            3: { top: 67.14, left: 16.68, name: "Forestfall" }, 
            4: { top: 32.00, left: 32.18, name: "Stormfallen" },
            5: { top: 58.98, left: 49.52, name: "Oceanrise" }, 
            6: { top: 32.00, left: 60.03, name: "Heathergan" }, 
            7: { top: 55.35, left: 56.83, name: "Winterfall" },
            8: { top: 70.77, left: 79.28, name: "Liddingal" },
            9: { top: 75.27, left: 56.20, name: "Hillinguard's bridge" },
            10: { top: 17.01, left: 77.10, name: "Highsky mountain" },
            11: { top: 13.20, left: 56.20, name: "Coldwind mountain" },
            12: { top: 46.41, left: 37.70, name: "Waterrise Sea" },
            13: { top: 53.67, left: 27.80, name: "Woodrise mountain" },
            14: { top: 71.09, left: 36.30, name: "Brightwood forest" },
            15: { top: 76.17, left: 44.90, name: "Hillinguard's underhills" },
            16: { top: 25.54, left: 32.20, name: "Stormfallen's hills" },
            17: { top: 51.85, left: 20.60, name: "Lonelygan Mountain" },
            18: { top: 46.95, left: 65.40, name: "Deepwater Sea" },
            19: { top: 24.27, left: 62.00, name: "Tightway waters" },
            20: { top: 16.47, left: 62.60, name: "Windfoldigan's bridge" },
            21: { top: 77.63, left: 79.60, name: "Frozencold Island" },
            22: { top: 63.65, left: 51.00, name: "Sandyland Island" },
            23: { top: 23.91, left: 56.60, name: "Northwind Island" },
            24: { top: 26.08, left: 50.00, name: "Singlehill Mountain" },
            25: { top: 72.54, left: 24.60, name: "Ashe's Forest" },
            26: { top: 70.55, left: 61.40, name: "Windyleafgan Forest" },
            27: { top: 22.09, left: 66.30, name: "Winterfold Forest" },
            28: { top: 51.31, left: 52.00, name: "Heathergan's bridge" },
            29: { top: 44.23, left: 23.40, name: "Waterfallengal Sea" },
            30: { top: 8.84, left: 84.70, name: "Wintercoldenfold Forest" },
            31: { top: 13.02, left: 37.10, name: "Northleaf Island" },
            
        };

        const viewport = document.getElementById('viewport');
        const mapContainer = document.getElementById('map-container');
        const mapImg = document.getElementById('world-map');
        const markersLayer = document.getElementById('markers-layer');

        let currentZoom = 1.0;
        const BASE_WIDTH = 1000; 

        const urlParams = new URLSearchParams(window.location.search);
        const locId = urlParams.get('loc');
        const targetLoc = MAP_LOCATIONS[locId];

        // --- –§–£–ù–ö–¶–Ü–á –ú–ê–°–®–¢–ê–ë–£–í–ê–ù–ù–Ø ---

        function setZoom(zoomLevel, disableAutoCenter = false) {
            // –û–±–º–µ–∂–µ–Ω–Ω—è
            if (zoomLevel < 0.3) zoomLevel = 0.3; 
            if (zoomLevel > 4.0) zoomLevel = 4.0;
            
            currentZoom = zoomLevel;
            const newWidth = BASE_WIDTH * currentZoom;
            
            mapImg.style.width = newWidth + 'px';
            mapContainer.style.width = newWidth + 'px';
            
            if (mapImg.naturalWidth) {
                 const ratio = mapImg.naturalHeight / mapImg.naturalWidth;
                 mapContainer.style.height = (newWidth * ratio) + 'px';
            }
            
            centerContainerVertically();

            // –Ø–∫—â–æ —î —Ü—ñ–ª—å —ñ –º–∏ –ù–ï –∑–∞–±–æ—Ä–æ–Ω–∏–ª–∏ –∞–≤—Ç–æ-—Ü–µ–Ω—Ç—Ä (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ)
            if (targetLoc && !disableAutoCenter) {
                centerOnLocation(targetLoc, newWidth);
            }
        }

        function centerContainerVertically() {
            const screenH = viewport.clientHeight;
            const mapH = mapContainer.clientHeight;
            
            if (mapH < screenH) {
                const topMargin = (screenH - mapH) / 2;
                mapContainer.style.marginTop = topMargin + 'px';
            } else {
                mapContainer.style.marginTop = '0px';
            }
        }

        function centerOnLocation(loc, mapWidth) {
            const ratio = mapImg.naturalHeight / mapImg.naturalWidth || 0.7;
            const x = (loc.left / 100) * mapWidth;
            const y = (loc.top / 100) * (mapWidth * ratio);
            
            const screenW = viewport.clientWidth;
            const screenH = viewport.clientHeight;
            
            viewport.scrollLeft = x - screenW / 2;
            viewport.scrollTop = y - screenH / 2;
        }

        function changeZoom(factor) {
            setZoom(currentZoom * factor);
        }

        // --- –ú–ê–†–ö–ï–†–ò ---

        function createPlayerMarker(loc, text) {
            const marker = document.createElement('div');
            marker.className = 'player-marker';
            marker.style.left = loc.left + '%';
            marker.style.top = loc.top + '%';
            
            const label = document.createElement('div');
            label.className = 'location-label';
            label.innerText = text;
            label.style.left = loc.left + '%';
            label.style.top = loc.top + '%';
            
            markersLayer.appendChild(marker);
            markersLayer.appendChild(label);
        }

        function createDot(loc) {
            const dot = document.createElement('div');
            dot.className = 'location-dot';
            dot.style.left = loc.left + '%';
            dot.style.top = loc.top + '%';
            dot.onclick = () => alert(loc.name);
            markersLayer.appendChild(dot);
        }

        // --- –ó–ê–ü–£–°–ö ---
        mapImg.onload = () => {
            for (const [id, loc] of Object.entries(MAP_LOCATIONS)) {
                if (id != locId) createDot(loc);
            }

            if (targetLoc) {
                createPlayerMarker(targetLoc, "üìç –í–ò –¢–£–¢");
                setZoom(1.5); 
                setTimeout(() => centerOnLocation(targetLoc, BASE_WIDTH * 1.5), 50);
            } else {
                const screenWidth = window.innerWidth;
                const fitZoom = screenWidth / BASE_WIDTH;
                setZoom(fitZoom > 1 ? 1 : fitZoom); 
            }
        };

        // ==================================================
        // üî• –¢–Ø–ì–ê–ù–ù–Ø –ú–ò–®–ö–û–Æ (–î–õ–Ø –ü–ö)
        // ==================================================
        let isDragging = false;
        let startX, startY, scrollLeft, scrollTop;

        viewport.addEventListener('mousedown', (e) => {
            isDragging = true;
            viewport.style.cursor = 'grabbing';
            startX = e.pageX - viewport.offsetLeft;
            startY = e.pageY - viewport.offsetTop;
            scrollLeft = viewport.scrollLeft;
            scrollTop = viewport.scrollTop;
        });

        viewport.addEventListener('mouseleave', () => { isDragging = false; viewport.style.cursor = 'grab'; });
        viewport.addEventListener('mouseup', () => { isDragging = false; viewport.style.cursor = 'grab'; });

        viewport.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.pageX - viewport.offsetLeft;
            const y = e.pageY - viewport.offsetTop;
            const walkX = (x - startX); 
            const walkY = (y - startY);
            viewport.scrollLeft = scrollLeft - walkX;
            viewport.scrollTop = scrollTop - walkY;
        });

        // ==================================================
        // üî• –†–û–ó–£–ú–ù–ò–ô –ó–£–ú –ö–û–õ–ï–°–û–ú (–î–æ –∫—É—Ä—Å–æ—Ä—É)
        // ==================================================
        viewport.addEventListener('wheel', (e) => {
            e.preventDefault();

            const rect = mapContainer.getBoundingClientRect();
            
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –º–∏—à—ñ –≤—ñ–¥–Ω–æ—Å–Ω–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // –ù–∞–ø—Ä—è–º–æ–∫ –∑—É–º—É
            const factor = e.deltaY < 0 ? 1.1 : 0.9;
            const oldZoom = currentZoom;
            
            // –í–∏–∫–ª–∏–∫–∞—î–º–æ –∑—É–º, –∞–ª–µ –ó–ê–ë–û–†–û–ù–Ø–Ñ–ú–û –∞–≤—Ç–æ-—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ –≥—Ä–∞–≤—Ü—ñ
            setZoom(currentZoom * factor, true);
            
            // –†–∞—Ö—É—î–º–æ —Ä–µ–∞–ª—å–Ω—É –∑–º—ñ–Ω—É –º–∞—Å—à—Ç–∞–±—É
            const realFactor = currentZoom / oldZoom;

            if (realFactor !== 1) {
                // –ö–æ—Ä–∏–≥—É—î–º–æ —Å–∫—Ä–æ–ª, —â–æ–± —Ç–æ—á–∫–∞ –ø—ñ–¥ –º–∏—à–∫–æ—é –∑–∞–ª–∏—à–∏–ª–∞—Å—è –Ω–∞ –º—ñ—Å—Ü—ñ
                viewport.scrollLeft += mouseX * (realFactor - 1);
                viewport.scrollTop += mouseY * (realFactor - 1);
            }

        }, { passive: false });

        // ==================================================
        // üî• –ñ–ï–°–¢–ò –î–õ–Ø –¢–ï–õ–ï–§–û–ù–£ (PINCH-TO-ZOOM)
        // ==================================================
        let initialDistance = 0;
        let initialZoom = 1.0;

        viewport.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                initialDistance = getDistance(e.touches);
                initialZoom = currentZoom;
            }
        }, { passive: false });

        viewport.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const currentDistance = getDistance(e.touches);
                if (initialDistance > 0) {
                    const scale = currentDistance / initialDistance;
                    setZoom(initialZoom * scale, true); // –¢–∞–∫–æ–∂ –±–µ–∑ –∞–≤—Ç–æ-—Ü–µ–Ω—Ç—Ä—É
                }
            }
        }, { passive: false });

        function getDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

    </script>
</body>
</html>
